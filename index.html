<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Church Attendance Dashboard</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg" />
    <link rel="stylesheet" href="assets/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header class="page-header">
      <div class="layout-shell">
        <h1>Church Attendance Dashboard</h1>
        <p class="subtitle">
          Explore weekly attendance and kids check-in trends tailored to the
          filters and dataset you choose.
        </p>
      </div>
    </header>

    <main class="layout-shell main-content">
      <section class="data-management" aria-labelledby="dataManagementHeading">
        <article class="data-card">
          <h2 id="dataManagementHeading">Data source</h2>
          <p id="datasetStatus" class="dataset-status" role="status" aria-live="polite">
            Using placeholder dataset generated for demonstration across multiple sites and years.
          </p>
          <div id="ingestNotices" class="ingest-notices" aria-live="polite"></div>
          <div class="data-actions">
            <label class="file-upload">
              <span>Upload CSV dataset</span>
              <input type="file" id="datasetUpload" accept=".csv" />
            </label>
            <button type="button" id="resetDataset" class="pill-button secondary">Reset to placeholder</button>
            <a class="pill-button" href="data/attendance.csv" download>Download sample CSV</a>
          </div>
          <details class="help-panel" open>
            <summary>Need a hand preparing your CSV?</summary>
            <div class="help-panel__content">
              <p><strong>Required columns:</strong> Week, Date (YYYY-MM-DD), Year, Month, Site, Service, Attendance, Kids Checked-in.</p>
              <p>
                Remove blank rows, keep values numeric, and ensure one row per Site &times; Service &times; Date combination.
                We'll trim extra spaces, normalize month names, and flag duplicates for you.
              </p>
              <p>
                Having trouble? Common fixes include renaming headers to match exactly, converting Excel dates to text, and
                saving the file as UTF-8 CSV.
              </p>
            </div>
          </details>
          <details class="guidelines">
            <summary>CSV formatting guidelines</summary>
            <ul>
              <li>
                Include a header row with the following columns: Week, Date, Year, Month, Site, Service,
                Attendance, Kids Checked-in.
              </li>
              <li>Use ISO format (<code>YYYY-MM-DD</code>) for the Date column.</li>
              <li>Year and Month should be stored as text (e.g. <code>2024</code>, <code>September</code>).</li>
              <li>Attendance and Kids Checked-in must contain whole numbers.</li>
              <li>Provide one row per site, service, and Sunday combination.</li>
            </ul>
          </details>
        </article>
      </section>

      <section id="emptyState" class="empty-state" aria-live="polite" hidden>
        <div class="empty-state__content">
          <h2>Load a CSV to begin</h2>
          <p>Upload your attendance CSV to unlock KPIs, charts, and insights tailored to your filters.</p>
          <table class="example-row" aria-label="Example CSV row">
            <thead>
              <tr>
                <th>Week</th>
                <th>Date</th>
                <th>Year</th>
                <th>Month</th>
                <th>Site</th>
                <th>Service</th>
                <th>Attendance</th>
                <th>Kids Checked-in</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>12</td>
                <td>2024-03-24</td>
                <td>2024</td>
                <td>March</td>
                <td>Downtown</td>
                <td>9am Gathering</td>
                <td>142</td>
                <td>36</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="controls">
        <div class="control-group toggle-group">
          <div class="control-header">
            <span class="control-label" id="yearToggleLabel">Year</span>
            <div class="control-actions" aria-hidden="true">
              <button type="button" class="control-action" data-target="year" data-action="select">Select all</button>
              <button type="button" class="control-action" data-target="year" data-action="clear">Clear all</button>
            </div>
          </div>
          <div class="toggle-options" id="yearToggle" role="group" aria-labelledby="yearToggleLabel"></div>
        </div>
        <div class="control-group toggle-group">
          <div class="control-header">
            <span class="control-label" id="siteToggleLabel">Site</span>
            <div class="control-actions" aria-hidden="true">
              <button type="button" class="control-action" data-target="site" data-action="select">Select all</button>
              <button type="button" class="control-action" data-target="site" data-action="clear">Clear all</button>
            </div>
          </div>
          <div class="toggle-options" id="siteToggle" role="group" aria-labelledby="siteToggleLabel"></div>
        </div>
        <div class="control-group toggle-group">
          <div class="control-header">
            <span class="control-label" id="serviceToggleLabel">Service</span>
            <div class="control-actions" aria-hidden="true">
              <button type="button" class="control-action" data-target="service" data-action="select">Select all</button>
              <button type="button" class="control-action" data-target="service" data-action="clear">Clear all</button>
            </div>
          </div>
          <div class="toggle-options" id="serviceToggle" role="group" aria-labelledby="serviceToggleLabel"></div>
        </div>
        <div class="control-group search-group">
          <label for="quickSearch">Quick search</label>
          <input type="search" id="quickSearch" placeholder="Find a site or service" />
        </div>
        <div class="control-group metric-toggle">
          <span>Primary metric</span>
          <label>
            <input type="radio" name="metric" value="Attendance" checked />
            Attendance
          </label>
          <label>
            <input type="radio" name="metric" value="Kids Checked-in" />
            Kids Checked-in
          </label>
        </div>
        <div class="control-group metric-toggle">
          <span>Weekly trend metrics</span>
          <label>
            <input type="checkbox" class="trend-metric" value="Attendance" checked />
            Attendance
          </label>
          <label>
            <input type="checkbox" class="trend-metric" value="Kids Checked-in" />
            Kids Checked-in
          </label>
        </div>
        <div class="control-group toggle-group include-zero-group">
          <label class="toggle-inline">
            <input type="checkbox" id="includeZeros" />
            Include zero attendance entries
          </label>
        </div>
      </section>

      <section class="filters-summary">
        <p id="activeFilters"></p>
      </section>

      <section class="summaries" aria-live="polite">
        <article class="summary-card summary-total">
          <div class="summary-card__header">
            <span class="summary-card__icon" aria-hidden="true">üìà</span>
            <h2>Total</h2>
          </div>
          <p id="summaryTotal" class="summary-value">0</p>
          <p class="summary-label" id="summaryTotalLabel">Total Attendance</p>
        </article>
        <article class="summary-card summary-average">
          <div class="summary-card__header">
            <span class="summary-card__icon" aria-hidden="true">üìä</span>
            <h2>Average per Week</h2>
          </div>
          <p id="summaryAverage" class="summary-value">0</p>
          <p class="summary-label">Based on available Sundays</p>
        </article>
        <article class="summary-card summary-peak">
          <div class="summary-card__header">
            <span class="summary-card__icon" aria-hidden="true">üöÄ</span>
            <h2>Peak Week</h2>
          </div>
          <p id="summaryPeak" class="summary-value">0</p>
          <p class="summary-label" id="summaryPeakLabel"></p>
        </article>
        <article class="summary-card summary-top-group">
          <div class="summary-card__header">
            <span class="summary-card__icon" aria-hidden="true">üèÜ</span>
            <h2>Top Group</h2>
          </div>
          <p id="summaryTopGroup" class="summary-value">0</p>
          <p class="summary-label" id="summaryTopGroupLabel"></p>
        </article>
      </section>

      <section class="insight-row">
        <article class="story-card">
          <header>
            <h2>Story</h2>
          </header>
          <p id="storySummary">Load a dataset to generate automated insights.</p>
          <ul id="anomalyHighlights" class="story-highlights" aria-live="polite"></ul>
        </article>
      </section>

      <section class="charts">
        <article class="chart-card">
          <div class="chart-header">
            <h2>Weekly Trend</h2>
            <div class="chart-actions">
              <button type="button" class="pill-button tertiary" data-chart="trend" data-export="png">Export PNG</button>
              <button type="button" class="pill-button tertiary" data-chart="trend" data-export="csv">Export filtered CSV</button>
            </div>
            <p>Aggregated by Sunday</p>
          </div>
          <div class="chart-area">
            <canvas
              id="trendChart"
              role="img"
              aria-label="Weekly attendance trend line chart."
            >
              Weekly trend line chart showing attendance totals.
            </canvas>
          </div>
        </article>
        <article class="chart-card">
          <div class="chart-header">
            <h2>Monthly Overview</h2>
            <div class="chart-actions">
              <div class="chart-toggle-group" id="monthlyModeToggle" role="radiogroup" aria-label="Monthly view mode">
                <button type="button" class="toggle-button small active" data-value="grouped" role="radio" aria-checked="true" tabindex="0">
                  Grouped
                </button>
                <button type="button" class="toggle-button small" data-value="stacked" role="radio" aria-checked="false" tabindex="-1">
                  Stacked
                </button>
              </div>
              <button type="button" class="pill-button tertiary" data-chart="monthly" data-export="png">Export PNG</button>
              <button type="button" class="pill-button tertiary" data-chart="monthly" data-export="csv">Export filtered CSV</button>
            </div>
            <p>Totals grouped by month across selected years</p>
          </div>
          <div class="chart-area">
            <canvas
              id="monthlyChart"
              role="img"
              aria-label="Monthly attendance totals bar chart."
            >
              Monthly bar chart showing attendance totals.
            </canvas>
          </div>
        </article>
        <article class="chart-card">
          <div class="chart-header">
            <div class="chart-title">
              <h2>Distribution</h2>
              <p id="distributionLabel">Share by service</p>
            </div>
            <div class="chart-actions">
              <div
                class="chart-toggle-group"
                id="distributionToggle"
                role="radiogroup"
                aria-label="Show distribution by"
              >
                <button
                  type="button"
                  class="toggle-button small active"
                  data-value="Service"
                  role="radio"
                  aria-checked="true"
                  tabindex="0"
                >
                  Service
                </button>
                <button
                  type="button"
                  class="toggle-button small"
                  data-value="Site"
                  role="radio"
                  aria-checked="false"
                  tabindex="-1"
                >
                  Site
                </button>
                <button
                  type="button"
                  class="toggle-button small"
                  data-value="Year"
                  role="radio"
                  aria-checked="false"
                  tabindex="-1"
                >
                  Year
                </button>
              </div>
              <div class="chart-toggle-group" id="distributionViewToggle" role="radiogroup" aria-label="Distribution view type">
                <button type="button" class="toggle-button small active" data-value="pie" role="radio" aria-checked="true" tabindex="0">
                  Pie
                </button>
                <button type="button" class="toggle-button small" data-value="bar" role="radio" aria-checked="false" tabindex="-1">
                  Bars
                </button>
              </div>
              <button type="button" class="pill-button tertiary" data-chart="distribution" data-export="png">Export PNG</button>
              <button type="button" class="pill-button tertiary" data-chart="distribution" data-export="csv">Export filtered CSV</button>
            </div>
          </div>
          <div class="chart-area">
            <canvas
              id="distributionChart"
              role="img"
              aria-label="Attendance distribution pie chart by service."
            >
              Pie chart showing attendance distribution by service.
            </canvas>
          </div>
        </article>
      </section>

      <section class="table-section">
        <div class="table-header">
          <h2>Recent Weeks</h2>
          <div class="table-controls">
            <label for="tablePageSize">Show</label>
            <select id="tablePageSize">
              <option value="50" selected>50</option>
              <option value="100">100</option>
              <option value="0">All</option>
            </select>
            <span>rows</span>
          </div>
          <p id="tableDescription">Showing the latest 50 entries based on the selected filters.</p>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th data-key="IsoWeek" scope="col">ISO Week</th>
                <th data-key="Date" scope="col">Date</th>
                <th data-key="Site" scope="col">Site</th>
                <th data-key="Service" scope="col">Service</th>
                <th id="metricHeader" data-key="Attendance" scope="col">Attendance</th>
                <th id="secondaryMetricHeader" data-key="Kids Checked-in" scope="col">Kids Checked-in</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </section>
    </main>

    <footer class="page-footer">
      <div class="layout-shell">
        <p>Placeholder data generated for demonstration purposes.</p>
      </div>
    </footer>

    <script type="module" src="assets/main.js"></script>
  </body>
</html>
